{"version":3,"sources":["assets\\scripts\\Game.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import { App } from \"./app/App\";\nimport { UICfg } from \"./cfg/UICfg\";\nimport { SoundMgr } from \"./mgrs/SoundMgr\";\nimport { httpClient } from \"./platform/HttpClient\";\nimport { HttpUrl } from \"./platform/HttpUrl\";\nimport { Save } from \"./saveManager/Save\";\nimport { SaveManager } from \"./saveManager/SaveManager\";\nimport { UIUtils } from \"./ui/UIUtils\";\nimport { objectUtils } from \"./utils/object-utils\";\n\nconst Fruit = cc.Class({\n    name: 'FruitItem',\n    properties: {\n        id: 0,\n        iconSF: cc.SpriteFrame\n    }\n});\n\nconst JuiceItem = cc.Class({\n    name: 'JuiceItem',\n    properties: {\n        particle: cc.SpriteFrame,\n        circle: cc.SpriteFrame,\n        slash: cc.SpriteFrame,\n    }\n});\n\nconst { ccclass, property } = cc._decorator;\n\n@ccclass\nexport default class Game extends cc.Component {\n\n    @property(Fruit)\n    private fruits = [];\n\n    @property(JuiceItem)\n    private juices = [];\n\n    @property(cc.Prefab)\n    private fruitPrefab = null;\n\n    @property(cc.Prefab)\n    private juicePrefab = null;\n\n    @property(cc.Node)\n    private fruitsNode: cc.Node = null;\n\n    @property(cc.Node)\n    private juicesNode: cc.Node = null;\n\n    @property(cc.Label)\n    private lbScores: cc.Label = null;\n\n    @property(cc.RichText)\n    private lbScoreTip: cc.RichText = null;\n\n    @property(cc.Node)\n    private bottomNode: cc.Node = null;\n\n    @property(cc.Button)\n    private btnOpenWheel:cc.Button = null;\n\n    private isCreating: boolean;        //是否在创建球中\n\n    private isLjIng: boolean;            //是否在连击中\n\n    private fruitCount: number;         //场上总共的数量\n\n    private currentFruit: cc.Node;      //当前水果    \n\n    private scoresTimer = null;          //连击计时器\n\n    private scoresTime = 1;             //连击有效时间\n\n    private ljScores = 0;               //连击分数\n\n    private ljCount = 0;                //连击次数\n\n    private _curScores = 0;             //当前总分\n\n    public set curScores(value: number) {\n        this._curScores = value;\n        if(this.targetScores > this.curScores){\n            this.lbScores.string = `${this.curScores}/${this.targetScores}`;\n            this.lbScoreTip.string = `再得<color = #CF5B5B>${this.targetScores - this.curScores}</c>分，即可获得额外提现机会`;\n        }\n        else{\n            this.lbScores.string = \"可提现\";\n            this.lbScoreTip.string = \"\";\n        }\n    }\n\n    public get curScores(): number {\n        return this._curScores;\n    }\n\n\n    private targetScores = 700;         //下一个目标分数    \n\n\n    onLoad() {\n        App.uiCfgMgr.initByCfg(UICfg);\n\n        UIUtils.addClickEvent(this.btnOpenWheel.node, ()=>{\n            App.uiMgr.openUI(UICfg.PannelWheel.name);\n        }, this);\n\n        // 监听点击事件 todo 是否能够注册全局事件\n        this.node.on(cc.Node.EventType.TOUCH_START, this.onTouchStart, this)\n\n\n        this.initGame();\n\n\n        setInterval(() => {\n            //console.log(\"保存游戏\");\n            this.saveGame();\n        }, 10000)\n        //console.log(\"读取游戏\");\n        this.readGame();\n    }\n\n    initGame() {\n        this.isCreating = false;\n        this.isLjIng = false;\n        this.initPhysics();\n        this.initOneFruit();\n    }\n\n    // 开启物理引擎和碰撞检测\n    initPhysics() {\n        // 物理引擎\n        const instance = cc.director.getPhysicsManager()\n        instance.enabled = true\n        // instance.debugDrawFlags = 4\n        instance.gravity = cc.v2(0, -960);\n\n        // 碰撞检测\n        const collisionManager = cc.director.getCollisionManager();\n        collisionManager.enabled = true;\n\n        // 设置四周的碰撞区域\n        let width = this.node.width;\n        let height = this.node.height;\n\n        let node = new cc.Node();\n\n        let body = node.addComponent(cc.RigidBody);\n        body.type = cc.RigidBodyType.Static;\n\n        const _addBound = (node, x, y, width, height) => {\n            let collider = node.addComponent(cc.PhysicsBoxCollider);\n            collider.offset.x = x;\n            collider.offset.y = y;\n            collider.size.width = width;\n            collider.size.height = height;\n        }\n\n        _addBound(node, 0, -height / 2 + this.bottomNode.height, width, 1);\n        _addBound(node, 0, height / 2, width, 1);\n        _addBound(node, -width / 2, 0, 1, height);\n        _addBound(node, width / 2, 0, 1, height);\n\n        node.parent = this.node;\n    }\n\n    initOneFruit(id = 1) {\n        this.fruitCount++;\n        this.currentFruit = this.createFruitOnPos(0, 400, id);\n    }\n\n    // 监听屏幕点击\n    onTouchStart(e) {\n        if (this.isCreating || this.isLjIng) return\n        this.isCreating = true\n        const { width, height } = this.node\n\n\n        const fruit = this.currentFruit\n\n        const pos = e.getLocation()\n        let { x, y } = pos\n        x = x - width / 2\n        y = y - height / 2\n\n        const action = cc.sequence(cc.moveBy(0.3, cc.v2(x, 0)).easing(cc.easeCubicActionIn()), cc.callFunc(() => {\n            // 开启物理效果\n            this.startFruitPhysics(fruit)\n\n            // 1s后重新生成一个\n            this.scheduleOnce(() => {\n                const nextId = this.getNextFruitId()\n                this.initOneFruit(nextId)\n                this.isCreating = false;\n            }, 1)\n        }))\n\n        fruit.runAction(action)\n    }\n\n    // 获取下一个水果的id\n    getNextFruitId() {\n        if (this.fruitCount < 3) {\n            return 1\n        } else if (this.fruitCount === 3) {\n            return 2\n        } else {\n            // 随机返回前5个\n            return Math.floor(Math.random() * 5) + 1\n        }\n    }\n\n    // 创建一个水果\n    createOneFruit(num) {\n        let fruit = cc.instantiate(this.fruitPrefab);\n        const config = this.fruits[num - 1]\n\n        fruit.getComponent('Fruit').init({\n            id: config.id,\n            iconSF: config.iconSF\n        });\n\n        fruit.getComponent(cc.RigidBody).type = cc.RigidBodyType.Static\n        fruit.getComponent(cc.PhysicsCircleCollider).radius = 0\n\n        this.fruitsNode.addChild(fruit);\n        fruit.scale = 0.6;\n\n        // 有Fruit组件传入\n        fruit.on('sameContact', this.onSameFruitContact.bind(this))\n\n        return fruit\n    }\n\n    startFruitPhysics(fruit) {\n        fruit.getComponent(cc.RigidBody).type = cc.RigidBodyType.Dynamic;\n        const physicsCircleCollider = fruit.getComponent(cc.PhysicsCircleCollider)\n        physicsCircleCollider.radius = fruit.height / 2\n        physicsCircleCollider.apply()\n    }\n\n    // 在指定位置生成水果\n    createFruitOnPos(x, y, type = 1) {\n        const fruit = this.createOneFruit(type)\n        fruit.setPosition(cc.v2(x, y));\n        return fruit\n    }\n\n    // 两个水果碰撞\n    onSameFruitContact({ self, other }) {\n        other.node.off('sameContact') // 两个node都会触发，todo 看看有没有其他方法只展示一次的\n\n        const id = other.getComponent('Fruit').id\n        // todo 可以使用对象池回收\n        self.node.removeFromParent(false)\n        other.node.removeFromParent(false)\n\n        const { x, y } = other.node\n\n        this.createFruitJuice(id, cc.v2({ x, y }), other.node.width)\n\n        const nextId = id + 1\n        if (nextId <= 11) {\n            const newFruit = this.createFruitOnPos(x, y, nextId)\n\n            this.startFruitPhysics(newFruit)\n\n            // 展示动画 todo 动画效果需要调整\n            newFruit.scale = 0\n            cc.tween(newFruit).to(.5, {\n                scale: 0.6\n            }, {\n                easing: \"backOut\"\n            }).start()\n        } else {\n            // todo 合成两个西瓜\n            console.log(' todo 合成两个西瓜 还没有实现哦~ ')\n        }\n\n        if (!this.scoresTimer) {\n            this.initLjTime();\n        }\n        this.setLjTimer();\n        let oneljScores = this.getljScores(nextId);\n        this.ljCount++;\n        this.ljScores += oneljScores;\n        this.curScores += this.ljScores;\n    }\n\n    //设置连击初始数据\n    private initLjTime() {\n        this.isLjIng = true;\n        this.ljCount = 0;\n    }\n\n    //重置连击计时器\n    private setLjTimer() {\n        this.scoresTimer = setTimeout(() => {\n            this.closeLjTime();\n        }, this.scoresTime * 1000);\n    }\n\n    //关闭连击计时器\n    private closeLjTime() {\n        clearTimeout(this.scoresTimer);\n        this.ljScores = 0;\n        this.scoresTimer = null;\n        this.isLjIng = false;\n        if (this.curScores >= this.targetScores) {\n\n        }\n    }\n\n    //获得连击分数\n    private getljScores(lv: number): number {\n        return 1;\n    }\n\n\n    // 合并时的动画效果\n    createFruitJuice(id, pos, n) {\n        // 播放合并的声音\n        // cc.audioEngine.play(this.boomAudio, false, 1);\n        // cc.audioEngine.play(this.waterAudio, false, 1);\n\n        App.soundMgr.playEffect(\"common/sounds/boom\");\n        App.soundMgr.playEffect(\"common/sounds/water\");\n\n        // 展示动画\n        let juice = cc.instantiate(this.juicePrefab);\n        this.juicesNode.addChild(juice);\n\n        const config = this.juices[id - 1]\n        const instance = juice.getComponent('Juice')\n        instance.init(config)\n        instance.showJuice(pos, n)\n    }\n\n\n    //游戏保存\n    saveGame() {\n        let fruitPosArray = [];\n        let fruitChild = this.fruitsNode.children;\n        for (let i = 0; i < fruitChild.length; i++) {\n            if (this.currentFruit.uuid != fruitChild[i].uuid) {\n                fruitPosArray.push(fruitChild[i].getComponent(\"Fruit\").getData());\n            }\n        }\n        SaveManager.Instance().setItem(Save.fruitsPos, fruitPosArray);\n\n        SaveManager.Instance().setItem(Save.gameScores, this.curScores);\n    }\n\n    //游戏读取\n    readGame() {\n        let gameData = SaveManager.Instance().getItem(Save.fruitsPos);\n        for (let i = 0; i < gameData.length; i++) {\n            let data = gameData[i];\n            this.startFruitPhysics(this.createFruitOnPos(data.pos.x, data.pos.y, data.id))\n        }\n\n        this.fruitCount = gameData.length;\n        this.curScores = SaveManager.Instance().getItem(Save.gameScores);\n    }\n\n}\n"]}