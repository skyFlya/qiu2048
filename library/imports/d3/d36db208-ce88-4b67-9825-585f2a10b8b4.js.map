{"version":3,"sources":["assets\\scripts\\utils\\animate-utils.ts"],"names":[],"mappings":";;;;;;;AAGA;;GAEG;AACU,QAAA,YAAY,GAAG;IAExB;;;;;;;;;;;;;OAaG;IACH,aAAa,EAAb,UACI,QAAiB,EACjB,MAAc,EACd,OAAe,EACf,MAA8B,EAC9B,MAAyF,EACzF,EAAa;QAEb,IAAI,MAAM,IAAI,IAAI;YAAE,MAAM,GAAG,EAAE,CAAC;QAChC,IAAI,MAAM,CAAC,QAAQ,IAAI,IAAI;YAAE,MAAM,CAAC,QAAQ,GAAG,KAAK,CAAC;QACrD,IAAI,MAAM,CAAC,OAAO,IAAI,IAAI;YAAE,MAAM,CAAC,OAAO,GAAG,CAAC,CAAC;QAC/C,IAAI,MAAM,CAAC,YAAY,IAAI,IAAI;YAAE,MAAM,CAAC,YAAY,GAAG,IAAI,CAAC;QAC5D,IAAI,MAAM,CAAC,SAAS,IAAI,IAAI;YAAE,MAAM,CAAC,SAAS,GAAG,CAAC,CAAC;QACnD,IAAI,MAAM,CAAC,gBAAgB,IAAI,IAAI;YAAE,MAAM,CAAC,gBAAgB,GAAG,KAAK,CAAC;QACrE,IAAI,MAAM,CAAC,SAAS,IAAI,IAAI;YAAE,MAAM,CAAC,SAAS,GAAG,IAAI,CAAC;QAEtD,IAAI,MAAM,GAAc,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QACzD,IAAI,CAAC,MAAM,EAAE;YACT,MAAM,GAAG,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;SAC7C;QAED,MAAM,CAAC,QAAQ,GAAG,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC;QACzC,MAAM,CAAC,IAAI,GAAG,KAAK,CAAC;QACpB,MAAM,CAAC,sBAAsB,EAAE,CAAC;QAEhC,IAAI,MAAM,CAAC,SAAS;YAAE,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC;QAEhD,IAAI,GAAG,GAAG,UAAC,MAAM;YACb,eAAe;YACf,IAAI,IAAI,GAAG,EAAE,CAAC;YACd,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,OAAO,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE;gBACtB,IAAI,CAAC,GAAG,EAAE,CAAC;gBACX,KAAK,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;oBACzC,IAAI,MAAM,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE;wBAC5B,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;wBAClB,MAAM,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;qBACvB;iBACJ;gBACD,CAAC,CAAC,OAAO,EAAE,CAAC;gBACZ,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBACtB,CAAC,EAAE,CAAC;aACP;YACD,MAAM,GAAG,IAAI,CAAC;YAEd,IAAI,cAAc,GAAG,IAAI,CAAC,CAAC,KAAK;YAEhC,IAAI,MAAM,CAAC,gBAAgB,EAAE;gBACzB,QAAQ;gBACR,cAAc,GAAG,EAAE,CAAC;gBACpB,KAAK,IAAI,CAAC,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,EAAE;oBACzC,cAAc,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC;iBAClC;gBACD,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC;aAC1C;YAED,IAAI,MAAM,CAAC,SAAS,GAAG,CAAC,EAAE;gBACtB,aAAa;gBACb,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,SAAS,EAAE,CAAC,EAAE,EAAE;oBACvC,MAAM,CAAC,MAAM,CAAC,MAAM,CAAC,GAAG,IAAI,CAAC;iBAChC;aACJ;YAED,IAAI,CAAC,GAAG,CAAC,CAAC;YACV,IAAI,CAAC,GAAG,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,CAAC;YACvC,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;YAC1B,MAAM,CAAC,QAAQ,CACX;gBACI,IAAI,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE;oBAC3B,MAAM,CAAC,WAAW,GAAG,MAAM,CAAC,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;iBAClD;gBACD,CAAC,EAAE,CAAC;gBACJ,IAAI,CAAC,IAAI,CAAC,EAAE;oBACR,MAAM,CAAC,sBAAsB,EAAE,CAAC;oBAChC,IAAI,MAAM,CAAC,SAAS,EAAE;wBAClB,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC;wBAC1B,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;qBAC9B;oBACD,EAAE,IAAI,EAAE,EAAE,CAAC;iBACd;YACL,CAAC,EACD,MAAM,CAAC,YAAY,EACnB,MAAM,CAAC,OAAO,GAAG,MAAM,CAAC,MAAM,GAAG,CAAC,CACrC,CAAC;YAEF,MAAM,CAAC,YAAY,CAAC;gBAChB,MAAM,CAAC,sBAAsB,EAAE,CAAC;gBAChC,IAAI,MAAM,CAAC,SAAS,EAAE;oBAClB,MAAM,CAAC,WAAW,GAAG,IAAI,CAAC;oBAC1B,MAAM,CAAC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;iBAC9B;gBACD,EAAE,IAAI,EAAE,EAAE,CAAC;YACf,CAAC,EAAE,MAAM,CAAC,QAAQ,CAAC,CAAC;QACxB,CAAC,CAAC;QAEF,IAAI,OAAO,IAAI,CAAC,EAAE;YACd,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,CAAC,WAAW,EAAE,UAAC,GAAG,EAAE,MAAM;gBACrD,IAAI,GAAG;oBAAE,OAAO,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAC7B,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO;oBAAE,OAAO;gBAC5D,GAAG,CAAC,MAAM,CAAC,CAAC;YAChB,CAAC,CAAC,CAAC;SACN;aAAM,IAAI,OAAO,IAAI,CAAC,EAAE;YACrB,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,EAAE,EAAE,CAAC,WAAW,EAAE,UAAC,GAAG,EAAE,KAAqB;gBACpE,IAAI,GAAG;oBAAE,OAAO,EAAE,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBAC7B,IAAI,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO;oBAAE,OAAO;gBAC5D,GAAG,CAAC,KAAK,CAAC,eAAe,EAAE,CAAC,CAAC;YACjC,CAAC,CAAC,CAAC;SACN;aAAM;YACH,EAAE,CAAC,IAAI,CAAC,SAAS,EAAE,OAAO,CAAC,CAAC;SAC/B;IACL,CAAC;IACD;;;;;;;KAOC;IACD,WAAW,EAAX,UAAY,WAA2B,EAAE,SAAkB,EAAE,UAAmB,EAAE,QAAkB;QAChG,IAAI,UAAU,GAAG,EAAE,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC,cAAc,CAAC,QAAQ,CAAC,CAAC;QACjE,IAAI,QAAQ,GAAG,UAAU,CAAC,oBAAoB,CAAC,SAAS,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAC7F,IAAI,MAAM,GAAG,UAAU,CAAC,oBAAoB,CAAC,UAAU,CAAC,qBAAqB,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;QAE5F,IAAI,IAAI,GAAG,IAAI,EAAE,CAAC,IAAI,EAAE,CAAC;QACzB,IAAI,CAAC,cAAc,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QAC9B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;QACnB,IAAI,CAAC,WAAW,CAAC,QAAQ,CAAC,CAAC;QAC3B,IAAI,MAAM,GAAG,IAAI,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC;QAC1C,MAAM,CAAC,WAAW,GAAG,WAAW,CAAC;QACjC,MAAM,CAAC,IAAI,GAAG,EAAE,CAAC,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;QACpC,MAAM,CAAC,QAAQ,GAAG,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC,GAAG,CAAC;QACzC,MAAM,CAAC,IAAI,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,UAAU,CAAC;QACzB,IAAI,OAAO,GAAG,EAAE,CAAC;QACjB,IAAI,MAAM,GAAG,EAAE,CAAC,EAAE,CAAC,QAAQ,CAAC,CAAC,GAAG,GAAG,EAAE,QAAQ,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC;QACvD,IAAI,MAAM,GAAG,CAAC,QAAQ,EAAE,MAAM,EAAE,MAAM,CAAC,CAAC;QACxC,IAAI,QAAQ,GAAG,EAAE,CAAC,QAAQ,CAAC,GAAG,EAAE,MAAM,CAAC,CAAC;QACxC,IAAI,OAAO,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAA;QACvC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC,CAAC;QAChC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC,CAAC;QAC1C,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAA;QAC7B,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC,QAAQ,CAAC;YACrB,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,QAAQ,IAAI,QAAQ,CAAC,UAAU,CAAC,CAAC;QACrC,CAAC,CAAC,CAAC,CAAA;QAEH,IAAI,CAAC,SAAS,CAAC,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;IACzC,CAAC;IAED;;;;;;;;OAQG;IACH,SAAS,YAAC,IAAI,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,EAAE,KAAK;QAC/C,WAAW;QACX,IAAI,MAAM,GAAG,KAAK,GAAG,OAAO,GAAG,GAAG,CAAC;QACnC,mBAAmB;QACnB,IAAI,GAAG,GAAG,UAAU,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QACzD,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,MAAM,GAAG,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC;QACpE,kBAAkB;QAClB,IAAI,GAAG,GAAG,UAAU,CAAC,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC,GAAG,UAAU,CAAC,CAAC,CAAC,GAAG,CAAC,CAAC;QACzD,IAAI,EAAE,GAAG,EAAE,CAAC,EAAE,CAAC,GAAG,EAAE,MAAM,GAAG,UAAU,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,GAAG,CAAC,CAAC;QACpE,OAAO;QACP,OAAO,EAAE,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,QAAQ,CAAC,CAAC,CAAC;IACjD,CAAC;CACJ,CAAA","file":"","sourceRoot":"/","sourcesContent":["import { mathUtils } from \"./math-utils\";\r\nimport { random } from \"./random\";\r\n\r\n/**\r\n * 动画工具类\r\n */\r\nexport const animateUtils = {\r\n\r\n    /**动态播放帧动画\r\n     @param playNode 播放帧动画的节点\r\n     @param resUrl 资源图集或散图所在的文件夹(图片名称随意,播放顺序为图片名称的数字和字母从小到大),bundle为null则从路径“resources/”开始\r\n     @param resType 资源类型[1:散图  2:图集]\r\n     @param bundle bundle包,可以为null\r\n     @param config 参数配置对象{ }\r\n     @param config.playTime 播放时间  默认不循环\r\n     @param config.loopNum 循环次数  默认一次\r\n     @param config.playInterval 播放间隔 默认0.12秒\r\n     @param config.loopPause 每次循环停顿帧数[最终时间=播放间隔*次数] 默认0\r\n     @param config.oppositePlayback 是否反向播放[即顺序播放一次,再倒着播放一次,算一个循环] 默认否\r\n     @param config.endToHide 播放完毕后是否隐藏动画  默认隐藏\r\n     @param cb 动画播放完毕后的回调\r\n     */\r\n    playFrameAnim(\r\n        playNode: cc.Node,\r\n        resUrl: string,\r\n        resType: number,\r\n        bundle: cc.AssetManager.Bundle,\r\n        config?: { playTime?, loopNum?, playInterval?, loopPause?, oppositePlayback?, endToHide?},\r\n        cb?: Function\r\n    ) {\r\n        if (config == null) config = {};\r\n        if (config.playTime == null) config.playTime = 99999;\r\n        if (config.loopNum == null) config.loopNum = 1;\r\n        if (config.playInterval == null) config.playInterval = 0.12;\r\n        if (config.loopPause == null) config.loopPause = 0;\r\n        if (config.oppositePlayback == null) config.oppositePlayback = false;\r\n        if (config.endToHide == null) config.endToHide = true;\r\n\r\n        let sprite: cc.Sprite = playNode.getComponent(cc.Sprite);\r\n        if (!sprite) {\r\n            sprite = playNode.addComponent(cc.Sprite);\r\n        }\r\n\r\n        sprite.sizeMode = cc.Sprite.SizeMode.RAW;\r\n        sprite.trim = false;\r\n        sprite.unscheduleAllCallbacks();\r\n\r\n        if (config.endToHide) sprite.spriteFrame = null;\r\n\r\n        let fun = (assets) => {\r\n            //按照数字和字母从小到大排序\r\n            let data = [];\r\n            let p = 1;\r\n            while (assets.length > 0) {\r\n                let l = [];\r\n                for (let i = assets.length - 1; i > -1; i--) {\r\n                    if (assets[i].name.length == p) {\r\n                        l.push(assets[i]);\r\n                        assets.splice(i, 1);\r\n                    }\r\n                }\r\n                l.reverse();\r\n                data = data.concat(l);\r\n                p++;\r\n            }\r\n            assets = data;\r\n\r\n            let assetsOpposite = null; //反向帧\r\n\r\n            if (config.oppositePlayback) {\r\n                //是否反向播放\r\n                assetsOpposite = [];\r\n                for (let i = assets.length - 1; i > -1; i--) {\r\n                    assetsOpposite.push(assets[i]);\r\n                }\r\n                assets = assets.concat(assetsOpposite);\r\n            }\r\n\r\n            if (config.loopPause > 0) {\r\n                //每个循环播放的停顿次数\r\n                for (let i = 0; i < config.loopPause; i++) {\r\n                    assets[assets.length] = null;\r\n                }\r\n            }\r\n\r\n            let m = 0;\r\n            let n = config.loopNum * assets.length;\r\n            sprite.node.active = true;\r\n            sprite.schedule(\r\n                () => {\r\n                    if (assets[m % assets.length]) {\r\n                        sprite.spriteFrame = assets[m % assets.length];\r\n                    }\r\n                    m++;\r\n                    if (m == n) {\r\n                        sprite.unscheduleAllCallbacks();\r\n                        if (config.endToHide) {\r\n                            sprite.spriteFrame = null;\r\n                            sprite.node.active = false;\r\n                        }\r\n                        cb && cb();\r\n                    }\r\n                },\r\n                config.playInterval,\r\n                config.loopNum * assets.length - 1\r\n            );\r\n\r\n            sprite.scheduleOnce(() => {\r\n                sprite.unscheduleAllCallbacks();\r\n                if (config.endToHide) {\r\n                    sprite.spriteFrame = null;\r\n                    sprite.node.active = false;\r\n                }\r\n                cb && cb();\r\n            }, config.playTime);\r\n        };\r\n\r\n        if (resType == 1) {\r\n            this.loadDir(bundle, resUrl, cc.SpriteFrame, (err, assets) => {\r\n                if (err) return cc.warn(err);\r\n                if (!sprite || !sprite.node || !sprite.node.isValid) return;\r\n                fun(assets);\r\n            });\r\n        } else if (resType == 2) {\r\n            this.loadDir(bundle, resUrl, cc.SpriteAtlas, (err, atlas: cc.SpriteAtlas) => {\r\n                if (err) return cc.warn(err);\r\n                if (!sprite || !sprite.node || !sprite.node.isValid) return;\r\n                fun(atlas.getSpriteFrames());\r\n            });\r\n        } else {\r\n            cc.warn(\"动画类型未实现\", resType);\r\n        }\r\n    },\r\n    /**\r\n   * 播放一个贝塞尔曲线的播放轨迹,用于金币，砖石，道具飞入背包\r\n   * @param spriteFrame \r\n   * @param startNode \r\n   * @param target \r\n   * @param callback \r\n   * @param scale \r\n   */\r\n    playAnimate(spriteFrame: cc.SpriteFrame, startNode: cc.Node, targetNode: cc.Node, callback: Function) {\r\n        let canvasNode = cc.director.getScene().getChildByName('Canvas');\r\n        let startPos = canvasNode.convertToNodeSpaceAR(startNode.convertToWorldSpaceAR(cc.v2(0, 0)));\r\n        let endPos = canvasNode.convertToNodeSpaceAR(targetNode.convertToWorldSpaceAR(cc.v2(0, 0)));\r\n\r\n        let node = new cc.Node();\r\n        node.setContentSize(136, 136);\r\n        node.zIndex = 2001;\r\n        node.setPosition(startPos);\r\n        let sprite = node.addComponent(cc.Sprite);\r\n        sprite.spriteFrame = spriteFrame;\r\n        sprite.type = cc.Sprite.Type.SIMPLE;\r\n        sprite.sizeMode = cc.Sprite.SizeMode.RAW;\r\n        sprite.trim = false;\r\n        node.parent = canvasNode;\r\n        let actions = [];\r\n        let midPos = cc.v2(startPos.x + 150, startPos.y - 150);\r\n        let bezier = [startPos, midPos, endPos];\r\n        let bezierTo = cc.bezierTo(0.5, bezier);\r\n        let scaleTo = cc.scaleTo(0.5, 0.3, 0.3)\r\n        actions.push(cc.delayTime(0.3));\r\n        actions.push(cc.spawn(scaleTo, bezierTo));\r\n        actions.push(cc.fadeOut(0.2))\r\n        actions.push(cc.callFunc(() => {\r\n            node.destroy();\r\n            callback && callback(targetNode);\r\n        }))\r\n\r\n        node.runAction(cc.sequence(actions));\r\n    },\r\n\r\n    /**\r\n     * 获取金币运动的曲线\r\n     * @param time 时间 \r\n     * @param startPoint 开始坐标\r\n     * @param endPoint 结束坐标\r\n     * @param height 高度\r\n     * @param angle 角度\r\n     * @returns \r\n     */\r\n    getBezier(time, startPoint, endPoint, height, angle) {\r\n        // 把角度转换为弧度\r\n        let radian = angle * 3.14159 / 180;\r\n        // 第一个控制点为抛物线左半弧的中点\r\n        let q1x = startPoint.x + (endPoint.x - startPoint.x) / 4;\r\n        let q1 = cc.v2(q1x, height + startPoint.y + Math.cos(radian) * q1x);\r\n        // 第二个控制点为整个抛物线的中点\r\n        let q2x = startPoint.x + (endPoint.x - startPoint.x) / 2;\r\n        let q2 = cc.v2(q2x, height + startPoint.y + Math.cos(radian) * q2x);\r\n        // 曲线配置\r\n        return cc.bezierTo(time, [q1, q2, endPoint]);\r\n    }\r\n}"]}