{"version":3,"sources":["assets\\scripts\\pannels\\PannelWheel.ts"],"names":[],"mappings":";;;;;AAAA,oBAAoB;AACpB,wEAAwE;AACxE,mBAAmB;AACnB,kFAAkF;AAClF,8BAA8B;AAC9B,kFAAkF;;;;;;;;;;;;;;;;;;;;;AAElF,sCAAqC;AACrC,uCAAkC;AAClC,yCAAwC;AAElC,IAAA,KAAwB,EAAE,CAAC,UAAU,EAAnC,OAAO,aAAA,EAAE,QAAQ,cAAkB,CAAC;AAG5C;IAAyC,+BAAM;IAwB3C;QAAA,YACI,iBAAO,SAEV;QAxBO,oBAAc,GAAY,IAAI,CAAC;QAG/B,aAAO,GAAc,IAAI,CAAC;QAG1B,cAAQ,GAAc,IAAI,CAAC;QAG3B,eAAS,GAAqB,EAAE,CAAC;QAEjC,oBAAc,GAAG,KAAK,CAAC;QAEvB,gBAAU,GAAG,CAAC,CAAC,CAAA,OAAO;QACtB,WAAK,GAAG,CAAC,CAAC,CAAA,aAAa;QACvB,gBAAU,GAAG,CAAC,CAAC,CAAA,WAAW;QAC1B,YAAM,GAAG,CAAC,CAAC,CAAA,YAAY;QACvB,kBAAY,GAAG,KAAK,CAAC,CAAA,YAAY;QACjC,mBAAa,GAAG,CAAC,CAAC,CAAA,uBAAuB;QAK7C,KAAI,CAAC,OAAO,GAAG,aAAK,CAAC,WAAW,CAAC,IAAI,CAAC;;IAC1C,CAAC;IAED,4BAAM,GAAN;QACI,iBAAO,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;QACjE,iBAAO,CAAC,aAAa,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;QAGnE,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,MAAM,CAAC;IAC7D,CAAC;IAED,4BAAM,GAAN,UAAO,EAAE;QACL,IAAI,IAAI,CAAC,cAAc,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC,EAAE;YAC9C,IAAI,CAAC,UAAU,EAAE,CAAC;YAClB,IAAI,IAAI,CAAC,UAAU,IAAI,IAAI,CAAC,KAAK,EAAE;gBAC/B,OAAO;gBACP,IAAI,CAAC,UAAU,EAAE,CAAC;gBAClB,IAAI,IAAI,CAAC,UAAU,IAAI,CAAC,EAAE;oBACtB,IAAI,IAAI,CAAC,MAAM,IAAI,CAAC,EAAE;wBAClB,IAAI,IAAI,CAAC,YAAY,EAAE;4BACnB,IAAI,CAAC,cAAc,GAAG,KAAK,CAAC;4BAC5B,IAAI,CAAC,YAAY,GAAG,KAAK,CAAC;4BAC1B,IAAI,CAAC,YAAY,EAAE,CAAC;yBACvB;6BAAM;4BACH,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC;yBAC5B;wBACD,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,aAAa,GAAG,CAAC,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,GAAG,CAAC,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;wBAC7I,IAAI,IAAI,CAAC,UAAU,IAAI,EAAE,EAAE;4BACvB,IAAI,CAAC,UAAU,IAAI,CAAC,CAAC;yBACxB;qBACJ;iBACJ;gBAED,IAAI,IAAI,CAAC,cAAc,EAAE;oBACrB,OAAO;oBACP,IAAI,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;oBAE7D,IAAI,CAAC,aAAa,EAAE,CAAC;oBACrB,IAAI,IAAI,CAAC,aAAa,IAAI,IAAI,CAAC,aAAa,EAAE;wBAC1C,IAAI,CAAC,aAAa,GAAG,CAAC,CAAC;qBAC1B;oBAED,IAAI,QAAQ,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;oBAEhE,IAAI,KAAK,IAAI,QAAQ,EAAE;wBACnB,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;wBAC9D,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;qBACpE;oBAID,OAAO;oBACP,IAAI,CAAC,UAAU,GAAG,CAAC,CAAC;oBACpB,IAAI,IAAI,CAAC,YAAY,EAAE;wBACnB,gBAAgB;wBAChB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC,EAAE,CAAC,CAAC,GAAG,EAAE,CAAC,CAAC;qBAC9D;iBACJ;qBACI;oBACD,IAAI,KAAK,GAAG,IAAI,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;oBAC7D,IAAI,KAAK,EAAE;wBACP,KAAK,CAAC,YAAY,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC;qBACjE;iBACJ;aACJ;SACJ;IACL,CAAC;IAEO,kCAAY,GAApB;IAEA,CAAC;IAEO,iCAAW,GAAnB;QACI,IAAI,IAAI,GAAG,IAAI,CAAC;QAChB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC,CAAC;QAE5C,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,aAAa,GAAG,CAAC,GAAG,IAAI,CAAC,MAAM,CAAC;QACvD,IAAI,CAAC,KAAK,GAAG,CAAC,CAAC;QAEf,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC;IAC/B,CAAC;IAvGD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;uDACqB;IAGvC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;gDACc;IAGlC;QADC,QAAQ,CAAC,EAAE,CAAC,MAAM,CAAC;iDACe;IAGnC;QADC,QAAQ,CAAC,EAAE,CAAC,WAAW,CAAC;kDACgB;IAZxB,WAAW;QAD/B,OAAO;OACa,WAAW,CA8G/B;IAAD,kBAAC;CA9GD,AA8GC,CA9GwC,gBAAM,GA8G9C;kBA9GoB,WAAW","file":"","sourceRoot":"/","sourcesContent":["// Learn TypeScript:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nimport { UICfg } from \"../cfg/UICfg\";\r\nimport UIBase from \"../ui/UIBase\";\r\nimport { UIUtils } from \"../ui/UIUtils\";\r\n\r\nconst { ccclass, property } = cc._decorator;\r\n\r\n@ccclass\r\nexport default class PannelWheel extends UIBase {\r\n\r\n    @property(cc.Node)\r\n    private prizeFrameNode: cc.Node = null;\r\n\r\n    @property(cc.Button)\r\n    private btnChou: cc.Button = null;\r\n\r\n    @property(cc.Button)\r\n    private btnClose: cc.Button = null;\r\n\r\n    @property(cc.SpriteFrame)\r\n    private selectImg: cc.SpriteFrame[] = [];\r\n\r\n    private wheelIsRunning = false;\r\n    private maxPrizeIndex: number;\r\n    private turnNumber = 0;// 转动格数\r\n    private speed = 0;// 速度（多少帧跳一格）\r\n    private currentFps = 0;// 与speed配合\r\n    private turnId = 0;// 下发的要转到的坑位\r\n    private hasWheelDraw = false;// 与turnId配合\r\n    private getPrizeIndex = 0;// 当前选中坑位（实际坑位从1开始）    \r\n\r\n\r\n    constructor() {\r\n        super();\r\n        this._uiName = UICfg.PannelWheel.name;\r\n    }\r\n\r\n    onLoad() {\r\n        UIUtils.addClickEvent(this.btnChou.node, this.onClickChou, this);\r\n        UIUtils.addClickEvent(this.btnClose.node, this.onCloseClick, this);\r\n\r\n\r\n        this.maxPrizeIndex = this.prizeFrameNode.children.length;\r\n    }\r\n\r\n    update(dt) {\r\n        if (this.wheelIsRunning && (this.turnNumber > 0)) {\r\n            this.currentFps++;\r\n            if (this.currentFps >= this.speed) {\r\n                // 转了一格\r\n                this.turnNumber--;\r\n                if (this.turnNumber <= 0) {\r\n                    if (this.turnId >= 0) {\r\n                        if (this.hasWheelDraw) {\r\n                            this.wheelIsRunning = false;\r\n                            this.hasWheelDraw = false;\r\n                            this.openPrizeWin();\r\n                        } else {\r\n                            this.hasWheelDraw = true;\r\n                        }\r\n                        this.turnNumber = this.maxPrizeIndex + (this.maxPrizeIndex - this.getPrizeIndex) + (this.getPrizeIndex + (this.turnId - this.getPrizeIndex));\r\n                        if (this.turnNumber >= 16) {\r\n                            this.turnNumber -= 8;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (this.wheelIsRunning) {\r\n                    // 转动效果\r\n                    let child = this.prizeFrameNode.children[this.getPrizeIndex];\r\n\r\n                    this.getPrizeIndex++;\r\n                    if (this.getPrizeIndex >= this.maxPrizeIndex) {\r\n                        this.getPrizeIndex = 0;\r\n                    }\r\n\r\n                    let childEnd = this.prizeFrameNode.children[this.getPrizeIndex];\r\n\r\n                    if (child && childEnd) {\r\n                        child.getComponent(cc.Sprite).spriteFrame = this.selectImg[0];\r\n                        childEnd.getComponent(cc.Sprite).spriteFrame = this.selectImg[1];\r\n                    }\r\n\r\n\r\n\r\n                    // 调整速度\r\n                    this.currentFps = 0;\r\n                    if (this.hasWheelDraw) {\r\n                        // this.speed++;\r\n                        this.speed = Math.sqrt(Math.pow((this.speed + 1), 2) + 16);\r\n                    }\r\n                }\r\n                else {\r\n                    let child = this.prizeFrameNode.children[this.getPrizeIndex];\r\n                    if (child) {\r\n                        child.getComponent(cc.Sprite).spriteFrame = this.selectImg[1];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private openPrizeWin() {\r\n\r\n    }\r\n\r\n    private onClickChou() {\r\n        let self = this;\r\n        this.turnId = Math.floor(Math.random() * 5);\r\n\r\n        this.turnNumber = this.maxPrizeIndex * 2 - this.turnId;\r\n        this.speed = 5;\r\n\r\n        this.wheelIsRunning = true;\r\n    }\r\n\r\n\r\n\r\n}\r\n"]}