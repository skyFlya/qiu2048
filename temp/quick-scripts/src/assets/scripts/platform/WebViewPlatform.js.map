{"version":3,"sources":["assets\\scripts\\platform\\WebViewPlatform.ts"],"names":[],"mappings":";;;;;;AAAA;IAAA;IAmIA,CAAC;IAhIiB,2BAAW,GAAzB;QACI,IAAI,eAAe,CAAC,SAAS,IAAI,IAAI,EAAE;YACnC,eAAe,CAAC,SAAS,GAAG,IAAI,eAAe,EAAE,CAAC;SACrD;QACD,OAAO,eAAe,CAAC,SAAS,CAAC;IACrC,CAAC;IAID,UAAU;IACF,gCAAM,GAAd,UAAe,UAAkB,EAAE,IAAI,EAAE,EAAG;QACxC,EAAE,CAAC,GAAG,CAAC,QAAQ,GAAG,UAAU,EAAE,IAAI,CAAC,CAAA;QACnC,IAAI,IAAI,GAAG,MAAM,CAAC,QAAQ,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC,IAAI,MAAM,CAAC,QAAQ,CAAC,CAAC,UAAU,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAA;QACjH,EAAE,CAAC,GAAG,CAAC,SAAS,EAAE,IAAI,CAAC,CAAA;QACvB,OAAO,IAAI,CAAA;IACf,CAAC;IAED;;;;;MAKE;IACF,8BAAI,GAAJ,UAAK,QAAgB,EAAE,MAAY,EAAE,QAAmB;QACpD,OAAO,IAAI,CAAC,WAAW,CAAC,QAAQ,EAAE,MAAM,EAAE,QAAQ,CAAC,CAAC;IACxD,CAAC;IAAA,CAAC;IAEM,qCAAW,GAAnB,UAAoB,UAAkB,EAAE,IAAI,EAAE,EAAG;QAC7C,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,OAAO,IAAI,IAAI,UAAU,EAAE;YAC3B,EAAE,GAAG,IAAI,CAAC;YACV,IAAI,GAAG,EAAE,CAAC;SACb;QACD,IAAI,OAAO,EAAE,IAAI,UAAU,EAAE;YACzB,MAAM,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YACrC,IAAI,MAAM,GAAG,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC;YACvC,MAAM,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;YACpB,IAAI,CAAC,WAAW,CAAC,GAAG,MAAM,CAAC;SAC9B;QACD,IAAI,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,IAAI,EAAE,CAAC,CAAA;QACjC,EAAE,CAAC,GAAG,CAAC,oBAAoB,GAAG,UAAU,GAAG,SAAS,GAAG,IAAI,CAAC,CAAA;QAC5D,IAAI,MAAM,CAAC,OAAO,CAAC,EAAE;YACjB,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,UAAU,EAAE,IAAI,CAAC,CAAC;SACpD;aAAM;YACH,IAAI,OAAO,MAAM,CAAC,WAAW,CAAC,IAAI,UAAU,EAAE;gBAC1C,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;aAC/C;iBAAM,IAAI,MAAM,CAAC,WAAW,CAAC,EAAE;gBAC5B,GAAG,GAAG,MAAM,CAAC,WAAW,CAAC,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;aACpD;iBAAM;gBACH,EAAE,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;gBACvB,IAAI,CAAC,WAAW,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;aACtC;SACJ;QACD,OAAO,GAAG,CAAC;IACf,CAAC;IAAA,CAAC;IAEM,qCAAW,GAAnB,UAAoB,MAAM,EAAE,IAAI;QAC5B,IAAI,MAAM,IAAI,QAAQ,EAAE;YACpB,IAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;YAChC,IAAM,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC;YAC3B,IAAM,IAAI,GAAG,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;YACvD,QAAQ,CAAC,IAAI,GAAG,IAAI,CAAC;SACxB;IACL,CAAC;IAAA,CAAC;IAEM,4CAAkB,GAA1B,UAA2B,GAAG,EAAE,IAAI;QAChC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;QAC5D,IAAI,KAAK,GAAG,IAAI,MAAM,CAAC,QAAQ,GAAG,IAAI,GAAG,WAAW,CAAC,EACjD,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAC9B,OAAO,OAAO,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,kBAAkB,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;IACjE,CAAC;IAAA,CAAC;IAIM,wCAAc,GAAtB,UAAuB,IAAI;QACvB,IAAI,GAAG,GAAG,IAAI,MAAM,CAAC,OAAO,GAAG,IAAI,GAAG,eAAe,CAAC,CAAC;QACvD,IAAI,CAAC,GAAG,MAAM,CAAC,QAAQ,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACpD,IAAI,CAAC,IAAI,IAAI;YAAE,OAAO,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;QACrC,OAAO,IAAI,CAAC;IAChB,CAAC;IAED,iCAAO,GAAP;QACI,OAAO,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAChC,CAAC;IACD,6CAAmB,GAAnB;QACI,IAAI,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;IACrC,CAAC;IAED,wCAAc,GAAd;QACI,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QACxC,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC;IAED,4CAAkB,GAAlB;QACI,IAAM,GAAG,GAAG,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;QAC5C,OAAO,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC3B,CAAC;IACD,2CAAiB,GAAjB;QACI,IAAI,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;IACnC,CAAC;IAED,8BAAI,GAAJ,UAAK,EAAY;QACb,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,EAAE,CAAC,CAAA;IACzB,CAAC;IAED,gCAAM,GAAN;QACI,OAAO,MAAM,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;IAC5C,CAAC;IAED,+CAAqB,GAArB,UAAsB,MAAM;QACxB,IAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAA;IAC1D,CAAC;IACD,sCAAY,GAAZ,UAAa,GAAW,EAAE,KAAa;QACnC,IAAI,CAAC,IAAI,CAAC,cAAc,EAAE,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAA;IACzD,CAAC;IACD,+CAAqB,GAArB,UAAsB,MAAc;QAChC,IAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,CAAA;IAC1D,CAAC;IAED;;;;OAIG;IACF,+BAAK,GAAL,UAAM,GAAQ,EAAE,QAAmB;QAChC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;IACxC,CAAC;IAhIc,yBAAS,GAAoB,IAAI,CAAC;IAkIrD,sBAAC;CAnID,AAmIC,IAAA;kBAnIoB,eAAe","file":"","sourceRoot":"/","sourcesContent":["export default class WebViewPlatform {\r\n    private static _instance: WebViewPlatform = null;\r\n\r\n    public static getInstance(): WebViewPlatform {\r\n        if (WebViewPlatform._instance == null) {\r\n            WebViewPlatform._instance = new WebViewPlatform();\r\n        }\r\n        return WebViewPlatform._instance;\r\n    }\r\n\r\n\r\n\r\n    /**JS调用 */\r\n    private jsCall(methodName: string, args, cb?): any {\r\n        cc.log(\"调用原生方法\" + methodName, args)\r\n        let info = window[\"Xmiles\"] && window[\"Xmiles\"][methodName] && window[\"Xmiles\"][methodName](JSON.stringify(args))\r\n        cc.log(\"原生方法返回值\", info)\r\n        return info\r\n    }\r\n\r\n    /**\r\n    * 与SDK交互通信\r\n    * @param funcName 方法名\r\n    * @param params 参数\r\n    * @param callback 回调\r\n    */\r\n    call(funcName: string, params?: any, callback?: Function) {\r\n        return this.callWebView(funcName, params, callback);\r\n    };\r\n\r\n    private callWebView(methodName: string, args, cb?) {\r\n        let ret = '';\r\n        if (typeof args == 'function') {\r\n            cb = args;\r\n            args = {};\r\n        }\r\n        if (typeof cb == 'function') {\r\n            window['dscb'] = window['dscb'] || 0;\r\n            let cbName = 'dscb' + window['dscb']++;\r\n            window[cbName] = cb;\r\n            args['_dscbstub'] = cbName;\r\n        }\r\n        args = JSON.stringify(args || {})\r\n        cc.log(\"原生调用 _methodName: \" + methodName + \" args: \" + args)\r\n        if (window['_dswk']) {\r\n            ret = prompt(window['_dswk'] + methodName, args);\r\n        } else {\r\n            if (typeof window['_dsbridge'] == 'function') {\r\n                ret = window['_dsbridge'](methodName, args);\r\n            } else if (window['_dsbridge']) {\r\n                ret = window['_dsbridge'].call(methodName, args);\r\n            } else {\r\n                cc.log('找不到_dsbridge');\r\n                this.callBrowser(methodName, args);\r\n            }\r\n        }\r\n        return ret;\r\n    };\r\n\r\n    private callBrowser(method, args) {\r\n        if (method == 'launch') {\r\n            const object = JSON.parse(args);\r\n            const param = object.param;\r\n            const html = this.getParameterByName(param, 'htmlUrl');\r\n            location.href = html;\r\n        }\r\n    };\r\n\r\n    private getParameterByName(url, name) {\r\n        name = name.replace(/[\\[]/, \"\\\\\\[\").replace(/[\\]]/, \"\\\\\\]\");\r\n        var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"),\r\n            results = regex.exec(url);\r\n        return results == null ? \"\" : decodeURIComponent(results[1]);\r\n    };\r\n\r\n\r\n\r\n    private getQueryString(name): string {\r\n        var reg = new RegExp(\"(^|&)\" + name + \"=([^&]*)(&|$)\");\r\n        var r = window.location.search.substr(1).match(reg);\r\n        if (r != null) return unescape(r[2]);\r\n        return null;\r\n    }\r\n\r\n    getHost() {\r\n        return this.call(\"getHost\");\r\n    }\r\n    showNoNetworkDialog() {\r\n        this.call(\"showNoNetworkDialog\");\r\n    }\r\n\r\n    getNotchHeight(): number {\r\n        const str = this.call(\"getNotchHeight\");\r\n        return JSON.parse(str);\r\n    }\r\n\r\n    getStatusBarHeight(): number {\r\n        const str = this.call(\"getStatusBarHeight\");\r\n        return JSON.parse(str);\r\n    }\r\n    finishCocosLaunch() {\r\n        this.call(\"finishCocosLaunch\");\r\n    }\r\n\r\n    bind(cb: Function) {\r\n        this.call('bind', cb)\r\n    }\r\n\r\n    isTest(): boolean {\r\n        return 'true' === (this.call(\"isTest\"));\r\n    }\r\n\r\n    enableOnResumeOnPause(enable) {\r\n        this.call('enableOnResumeOnPause', { enable: enable })\r\n    }\r\n    launchH5Page(url: string, title: string) {\r\n        this.call('launchH5Page', { url: url, title: title })\r\n    }\r\n    launchPromoteLinkPage(taskId: number) {\r\n        this.call('launchPromoteLinkPage', { taskId: taskId })\r\n    }\r\n\r\n    /**\r\n     * 提交埋点\r\n     * @param obj 神策参数\r\n     * @param callback 回调\r\n     */\r\n     track(obj: any, callback?: Function) {\r\n        this.jsCall('track', obj, callback);\r\n    }\r\n\r\n}"]}